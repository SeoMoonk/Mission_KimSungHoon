# 4Week_KimSungHoon.md

## Title: [4Week] 김성훈

### 미션 요구사항 분석 & 체크리스트

#### 필수과제_목표

- [x] 네이버 클라우드 플랫폼을 통한 배포
  - [x] HTTPS 적용
  - [x] 도메인 적용
  - [x] 배포 성공 (https://www.seomoon.site/)
  - [x] 각종 소셜 로그인 및 인스타그램 아이디 연동 가능

- [x] 내가 받은 호감 리스트에서 성별 필터링 기능 구현
  - [x] 남자 OR 여자에게 받은 호감내용만 필터링 가능

<br/>

#### 선택과제_목표
- [ ] 젠킨스를 통해서 리포지터리 커밋 발생시 자동으로 배포가 진행
  - [x] 서버에 젠킨스 설치 및 ACG 설정 변경, 연결
  - [x] 젠킨스 아이템 생성, 리포지터리 연동 후 빌드 성공
  - [ ] github hook 을 이용한 자동빌드

- [x] 내가 받은 호감리스트에서 호감사유를 통한 필터링 구현
  - [x] 받은 호감내용이 무엇인지에 따라(외모, 성격, 능력) 필터링 가능

- [x] 내가 받은 호감 리스트에서 정렬 가능
  - [x] 날짜순 정렬(최신순, 오래된 순)
  - [x] 인기순 정렬(인기가 많은 사람 순, 인기가 적은 사람 순)
  - [x] 성별순 (1순위 여성, 2순위 남성 + 추가조건 최신순)
  - [x] 호감사유순 (1순위 외모, 2순위 호감, 3순위 능력 + 추가조건 최신순)

<br/>

---

### 4주차 미션 요약

#### - 네이버 클라우드 플랫폼을 통한 Https, 도메인 적용 배포
#### - 호감 리스트 필터링
#### - 호감 리스트 정렬
#### - 젠킨스, Github Webhooks 을 통한 자동 배포

---

### [접근 방법]

#### 필수 미션

### 1. 네이버 클라우드 플랫폼을 통한 HTTPS, 도메인 적용 배포

1. **작업 내용** <br/>
  강사님의 강의자료 내용을 따라 서버 설정, 도커, MariaDB, GIT, JAVA17 설치 등을 진행하였고,
  미션 내용이 저장되어있는 Github 리포지터리의 main 브랜치를 clone 하였다. 클론한 내용에서 yml 파일에 도메인 이름으로
  수정이 필요한 부분들은 ex)custom.site.baseUrl => https://www.seomoon.site/ 와 같이 변경해 주었다.

<br/>

2. **Nginx Proxy Manager(NPM) 설치 후 도커 실행** <br/>
  npm을 설치하여 도커로 실행시켜주었고, 내 도메인이름(https://www.seomoon.site/)로 연결될 수 있도록
  설정을 진행하였다. 그리고 기존의 도커 이미지와 컨테이너를 종료 및 삭제한 뒤 새로 빌드한 후 다시 실행하였다.

<br/>

3. **각종 소셜로그인 및 인스타그램 연동 가능** <br/>
   새로 설정한 도메인으로 각 소셜로그인이 잘 이루어질 수 있도록 Redirect URI를 추가 해주었다.
   ex) https://www.codelike.app/login/oauth2/code/kakao

<br/>

---

### 2. 호감 리스트 필터링(필수미션 2, 선택미션 2)

1. **사전 작업** <br/>
  @RequestParam 어노테이션을 통해 프론트에서 select.option 태그를 통해 gender(성별) 와 attractiveTypeCode(호감사유)
  를 잘 받아올 수 있도록 하였다. required  옵션을 false 로 설정한 이유는 해당 옵션이 넘어오지 않더라도(전체 조회라도)
  페이지 조회는 원활히 되야 한다는 생각이 들어서 추가 해주었다.

<br/>

2. **필터링된 자료 얻기** <br/>
  로그인된 회원이 인스타그램 아이디까지 연동 된 것이 확인 된 경우라면, 본격적인 작업이 시작되게 된다.
  해당 필터링 기능을 구현할 때, 지금의 스트림 방식까지 오기까지 3가지의 방법을 시도해 보았다.

   <br/>
   
   1. **V1(단순 조회) => 나에 대한 호감에서 조건에 맞는 것들만 리스트에 추가하는 방법** <br/>
      filteringByGender 이라는 메서드를 사용하였으며, 단순하게 나에 대한 호감내용들 중에서
      나에게 호감을 준 사용자의 성별이 일치하는 것만 리스트에 담아 리턴해주는 방식이었다.
      너무 단순하게 for-each문을 사용하여 전체 탐색을 한 과정이어서. 걱정이 많이 되었다.

    <br/>

   2. **V2(쿼리 사용) => JPA Query를 이용하여 조건에 맞는 것들만 찾아오도록 하는 방법** <br/>
      filteringByGenderQuery라는 메서드를 사용하였으며, JPA Query를 직접 작성하여 조건에
      맞는 것들만 얻어오도록 Repository측에 조회가 가능하도록 쿼리문을 작성한 방법을 사용했다.
      조건에 맞는 내용들만 리스트에 담아 리턴하게 된다.

   <br/>

   3. **V3(Stream의 filter 메서드)** <br/>
      최종적으로 선택하게 된 방법이다. Stream과 filter를 사용하면 손쉰게 조건을 통한 필터링이 가능하다는
      점을 알게 되어서, 사용하게 되었고, 기능적으로는 뭐가 가장 좋은지 모르겠지만 코드가 가장 깔끔하다는
      생각이 들어 채택하게 되었다. (물론 다른 메서드들도 일단은 남겨두었다.) 나에 대한 호감들 중에
      filter 조건에 맞는 (성별, 호감코드, 혹은 둘다) 내용만 필터링하여 Stream 객체에 담아 리턴하게 된다.

<br/>

---

<br/>

#### 선택 미션

### 호감 목록 정렬

1. **사전 작업** <br/>
  위에서 언급한 필터링 과정에서 바로 이어지게 되는데, 필터링에서 Stream 형 객체 목록을 반환하게 되므로,
  해당 내용을 정렬할 수 있는 조건인 Comparator을 얻기 위해 sortCode를 마찬가지로 @RequestParam 어노테이션을
  통해 프론트 측에서 얻어올 수 있게 하였고, 여기에 정렬조건은 기본 세팅이 최신순(1번) 이므로 값이 할당되지 않은 경우
  기본 값이 1로 설정될 수 있도록 defaultValue = 1 로 설정하였다.

<br/>

2. **Comparator(정렬 조건) 얻어오기** <br/>
  필터링이 마쳐진 Stream 형 객체 목록을 정렬하기 위한 Comparator을 얻어오기 위해 sortCode를 매개변수로 받아
  어떤 정렬 조건을 받아올 것인지 선택할 수 있는 getComparator이라는 메서드를 작성하였다.
  해당 메서드에서 sortCode가 몇번인지에 따라 알맞은 정렬 조건을 얻어올 수 있도록 하였다.

    <br/> 

   1. **최신순, 오래된 순** <br/>
      여기서 유의해야할 점은 Comparator.comparing을 사용할 때 우선순위가 값이 큰 쪽으로 넘어가기 때문에,
      최신순일 경우에 오히려 .reverser() 를 사용해야 더 일찍 생성된 쪽이 상단으로 올 수 있도록 정렬 조건을 맞춰줄
      수 있다. 비교 대상은 getCreateDate를 사용했다. 수정일자가 비교대상이 되는게 더 맞지않나? 라는 생각도 했으나,
      현재 프론트에서 표기되는 날짜가 CreateDate 이기 때문에 유지하기로 하였다.

    <br/>   

   2. **인기가 많은 사람순, 적은 사람 순** <br/>
      InstaMember에서 getLikes()를 호출하면 그 사람이 인기가 얼마나 있는지 알 수 있기 때문에,
      나를 좋아하는 사람이 누구인지를 알아내고, 그 사람의 인기도를 얻어올 수 있도록
      likeablePerson.getFromInstaMember().getLikes() 을 통해 얻어온 값을 비교 대상으로 사용하였다.

    <br/>

   3. **성별순(1순위 여성, 2순위 남성, 추가조건은 최신순)** <br/>
       인기도와 마찬가지로 InstaMember에 gender가 저장되어 있기 때문에,
       likeablePerson.getFromInstaMember().getGender().equals("W") ? "0" : "1" 과 같이 여자인 경우
       를 판별하였다. 그 다음 남자인 경우를 판단하기 위해 똑같은 내용에 "M"이 일치하는지 확인하도록 하였으며,
       해당 내용은 thenComparing을 사용하여 그 다음의 비교조건이라는 의미의 메서드를 사용하였다.
       추가조건인 최신순 또한 thenComparing을 사용하였으며, 여기서 주의해야할 점은 최신순의 경우위에서 언급했듯이
       reversed()를 해주어야하는데, 전체 조건에 reversed()를 해주는 것이 아닌 최신순 조건에만 reverser()를
       적용하도록 해주어야 한다.

    <br/>

    4. **호감사유순(1순위 외모, 2순위 성격, 3순위 능력, 추가조건은 최신순)** <br/>
       attractiveType코드부터가 1 외모, 2 성격, 3 능력이기 때문에, 비교 대상을 attractiveTypeCode로 하여
       reversed() 해주기만 하면 간단히 정렬조건을 얻어올 수 있었다. 3번과 마찬가지로 추가 조건인 최신순은
       thenComparing을 통해 작성해 주었다.

<br/>
   
---

#### 젠킨스, Github Webhooks 을 통한 자동 배포

1. **작업 내용**  <br/>
  강사님의 강의자료를 보고 따라했으며, 서버에 ACG 설정을 추가함으로서 포트를 뚫어주고, 8081 포트에 젠킨스를
  연결하여 설치하는 것을 성공하였고, 그램그램이 저장되어 있는 깃허브 리포지터리를 연결하여 빌드한 결과, 자료가
  잘 받아지는 것 까지는 확인하였으나, 나의 도메인을 github hooks 에 연결하여 커밋이 수행되었을 때 자동으로 빌드되는
  과정을 시도했으나 잘 되지 않는것으로 마무리 하게 되었다.

### [특이 사항]

#### 필수 미션

1. 필터링을 도전할 때 3가지의 방법을 시도해 보았다. 결과는 모두 동일해 보였으나, 어떤것이 가장 좋은 접근인지는 구분이 되지 않는다.

#### 선택 미션


느낀점
- 젠킨스를 통한 자동 빌드에 대해 수업시간에 배웠으면 좋겠다는 생각이 들었다.
- 내가 구매한 도메인으로 모바일에서도 연결이 되는것이 참 신기했다.