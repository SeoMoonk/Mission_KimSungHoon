# 2Week_KimSungHoon.md

## Title: [2Week] 김성훈

### 미션 요구사항 분석 & 체크리스트

#### 필수과제_목표

- [x] CASE 4 : 한 명의 인스타 회원이 다른 회원에게 중복으로 호감표시를 할 수 없다.
- [X] CASE 5 : 인스타 회원은 최대 10명까지만 호감 상대를 등록할 수 있다.
- [x] CASE 6 : CASE 4 가 발생했을 때, 기존의 사유와 다른 사유로 호감을 표시하는 경우에는 수정으로 처리한다.

<br/>

#### 선택과제_목표
- [x] 스프링 OAuth2 클라이언트를 이용하여 네이버 소셜 로그인 구현하기
  - [x] 네이버 로그인으로 가입한 회원의 providerTypeCode : NAVER
  - [x] json 형태로 반환되는 네이버 로그인 정보에서 id만 추출하여 구성하기

<br/>

---

### 1주차 미션 요약

#### - LikeablePerson 에서 상대방에게 호감표시를 했을 때, 조건에 맞지 않는 경우는 걸러지도록 케이스 구성
#### - 스프링 OAuth2 클라이언트를 활용한 네이버 소셜 로그인 구현

---

### [접근 방법]

#### 필수 미션

1. **사전 작업** <br/>
   우선 like(호감표시) 가 수행될 때, 한 구성 안에 검사와 수행이 함께 있는 것이 좋지 않아 보여
   canILike 라는 메서드를 새로 구현하였다. 이 메서드 안에서는 내가 수행할 like 수행이 여러 조건들을
   통과할 수 있는지에 대하여 검사하고, 실패한 케이스에 따른 code 값을 int 값으로 반환한다.
   모든 조건을 통과해 호감표시가 가능한 경우에 대해서는 0을 반환하여 이후 작업이 수행되도록 하였다.

<br/>

2. **CASE 4 : 중복으로 호감표시 금지** <br/>
   like_list 라는 List 형태의 배열에 현재 호감 표시를 수행하려고 했던 member(주체)의 인스타 계정이
   좋아하고 있는 사람들의 목록을 넣어주었다. (member.getInstaMember().getFromLikeablePeople())
   for 반복문을 반복하면서 만약 이 배열을 순회하면서 이번에 호감을 표시하려고 했던 사람의 이름(username)
   과 해당 배열 요소의 username과 같은 경우가 발견된다면, 4번 실패 코드를 반환하고, 
   이에 따라 F-4 오류가 출력되도록 하였다.

<br/>

3. **CASE 5 : 호감 표시는 10명 까지만 가능** <br/>
   CASE 4 에서 사용했던 like_list 에는 언급했듯이 현재 주체가 좋아하고 있는 사람들의 목록이
   담겨져 있다. 그러므로 이 배열의 size 값은 현재 호감 표시한 사람의 명 수가 될 것이기 때문에.
   like_list.size() 값이 10보다 크거나 같은 경우, 추가적인 호감 표시를 막을 수 있도록
   5번 실패 코드를 반환하도록 하였고, 이에 따라 F-5 오류가 출력되도록 하였다. <br/>
   추가적으로, 처음에는 10이라는 값 그대로를 하드코딩하여 작성하였지만, 강사님이 주신 힌트를 듣고
   yml 파일에 최대값을 10으로 기재하고, base/Appconfig/Appconfig.java 파일에서 <br/>
   ${custom.likeablePerson.from.max} 과 같이 값을 받아옴으로써 yml 값만 변경하면 언제든지
   최대 호감표시 명 수를 변경할 수 있도록 하였다.

<br/>

4. **CASE 6 : 중복 호감 표시가 시도되었을 때, 기존 호감 내용과 다를 경우에는 수정 처리** <br/>
   CASE 4 에서 중복 호감 표시가 시도되었을 경우에는 무조건적으로 차단하도록 구현하였다면, 6번 케이스에서는
   차단하기 전에 한번 기존 호감 내용과 다른지에 대한 검증을 수행하도록 하였다. 4번 케이스와 동일하게
   like_list 의 내용을 하나씩 추출하여 for-each 반복문을 순회하게 되는데, 이 케이스를 구현하기 위해
   하나씩 추출한 내용인 toInstaMemberByList 의 내용 중 attractiveTypeCode 를 얻어 새 변수에 대입해 주였고.
   이번 호감표시 시도에서 들어온 attractiveTypeCode 의 값과 이전에 저장되어 있었던 attractiveTypeCode 의 값이
   다른 경우에는 호감 내용이 달라진 것으로 판단되어지기 때문에, 달라진 호감 내용을 변경할 수 있도록
   modify_attractiveTypeCode 라는 메서드를 새로 선언하고, 해당 메서드에서 attractiveTypeCode 값을 변경하여 주고,
   수정 일시를 의미하는 modifyDate 또한 현재 시각인 LocalDateTime.now()로 변경될 수 있도록 하였다.
   이 경우에는 수정을 완료한 후, 6번 실패 코드를 반환하도록 하였고, 이에 따라 F-6 오류가 출력되면서
   해당 내용의 이전 호감 내용과 바뀐 호감 내용에 대해 알릴 수 있도록 하였다.

<br/>

5. **CASE 6 에서의 개인적인 문제점** <br/>
   다만, 문제점이 검증 과정을 다른 메서드로 빼오는 과정에서 이전 호감 내용에 대해 얻어오는 과정에 문제가 생겨,
   현재 서비스 전체적인 변수로써 prev_attractiveTypeCode 라는 변수를 선언하여 수정 메서드가 종료되기 전에
   이전의 호감코드를 저장하고 있는 상황인데, 이것은 부적절하다고 생각하지만, 현재로써는 마땅한 해결책이 생각나지 않아
   보류중인 상태이다.

<br/>

6. **추가적인 내용** <br/>
   미션 내용에는 포함되지 않았지만 프론트 적으로도 에러 메세지가 출력되면 좋을 것 같다는 생각이 들어 다음과 같이
   CASE 5 (10명 제한 초과) 에 대하여서 오류 메세지를 출력되도록 하였다.

   ```javascript
   const fromLikeableSize =  /*[[ ${#lists.size(@rq.member.instaMember.fromLikeablePeople)} ]]*/ null;
   
   if(fromLikeableSize >= 10) 
   {
       toastWarning('최대 10명까지만 호감 표시가 가능합니다.');
       form.username.focus();
       return;
   }
   ```

<br/>

#### 선택 미션

1. 네이버 Developers 사이트에서 gramgram 애플리케이션을 등록하고, API 를 설정하고
   이에대한 클라이언트 ID, 시크릿 키 등을 가져왔다.

<br/>

2. 가져온 API 정보를 application-oauth.yml 에 대입하여 실행시켜본 결과 예상대로 고유 ID 값이
   일반적인 값이 아닌 json 형태로 표현되는 것을 발견했다.

<br/>

3. base/security/CustomOAuth2UserService.java 에서  providerTypeCode
   이 NAVER 인 경우에, 로그인 하면서 넘어온 oAuth2User의 response(JSON 형식) 속성 값을 
   Map<String, Object> response 에 대입하여 줌으로써,  response.get("id").toString() 을 시도하면
   로그인한 회원의 여러 정보 중에서 id 값만 String 값으로 얻어낼 수 있었다.

<br/>

4. 얻어온 해당 id 값을 oauthId에 대입하여 줌으로써  (providerTypeCode + "__%s".formatted(oauthId)) 를
   수행하여 Member(회원) 를 구성할 경우 원하던 표현대로 회원가입이 정상적으로 처리되는 것을 확인할 수 있었다.

---

### [특이 사항]

#### 필수 미션

추가구현
- 프론트 내용 업그레이드
- CASE 5 에 대하여 script 방면에서 오류 메세지가 표현되도록 추가
- 검증 메서드 따로 구현

느낀점
- 나는 내가 아는 지식 선에서 내 눈에 보이는 대로 구현을 했고, 실제로 그 수준 안에서는 그리 오랜 시간이 걸리지도 않았지만, 
  강사님이 주시는 힌트들을 보고 강사님이 원하는 방식은 이런 방식이 아닌 JpaRepository의 메서드를 활용한 방식이라던지, 
  yml을 통한 하드코딩 배제 등을 원하시는 것 같아 아직 모자름이 느껴졌다. 시간도 부족하고 아이디어가 막상 내용을 고치려니
  생각이 나지 않아 구현은 못했지만. 시야를 넓혀 다른 방식으로도 구현할 수 있다는 것을 염두에 두고 구현해야 겠다는 생각이 들었다.

<br/>

- 또한, 무언가를 시도해보려는 의도는 좋았으나 새로 구현할수록 어디선가 허점이 생겨서, 이런 점들을 대처할 수 있는 대처능력을
  더 익숙해져서 길러야 겠다는 생각이 많이 들었다. (현재 FIXME로 주석처리 되어있는 내용들.)

<br/>

#### 선택 미션

느낀점
- 다른 소셜로그인과는 다르게 json 형식으로 값이 넘어와 지는것이 상당히 특이했고, 괜찮은 방법이라는 생각이 들었다.
  또, 이렇게 내용을 매핑하여 그 중에서 원하는 값을 꺼내 쓰는것이 되게 좋은 경험이었다고 생각이 들며, 
  나중에 유용하게 쓸 수 있을 것 같다는 생각이 들었다.
